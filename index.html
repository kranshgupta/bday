<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Greeting</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function BirthdayGreeting() {
            const [cakeLayer, setCakeLayer] = useState(0);
            const [candlesLit, setCandlesLit] = useState(false);
            const [blown, setBlown] = useState(false);
            const [balloonsPopped, setBalloonsPopped] = useState(false);
            const [showWish, setShowWish] = useState(false);
            const [sparkles, setSparkles] = useState([]);
            const [confetti, setConfetti] = useState([]);
            const [listening, setListening] = useState(false);
            
            // Refs
            const audioRef = useRef(null);
            const audioContextRef = useRef(null);
            const analyserRef = useRef(null);
            const microphoneRef = useRef(null);
            const animationRef = useRef(null); 

            useEffect(() => {
                // 1. Initialize the Song
                // MAKE SURE 'senorita.mp3' IS IN THE SAME FOLDER
                audioRef.current = new Audio('senoritaa.mp3');
                audioRef.current.loop = true;
                audioRef.current.volume = 1.0; 

                // 2. Animation Timers
                const timers = [
                    setTimeout(() => setCakeLayer(1), 500),
                    setTimeout(() => setCakeLayer(2), 1000),
                    setTimeout(() => setCakeLayer(3), 1500),
                    setTimeout(() => setCakeLayer(4), 2000),
                    setTimeout(() => setCakeLayer(5), 2500),
                    setTimeout(() => {
                        setCandlesLit(true);
                    }, 3500)
                ];
                return () => {
                    timers.forEach(clearTimeout);
                    stopListening();
                    if (audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current.currentTime = 0;
                    }
                };
            }, []);

            const startListening = async () => {
                // *** IMPORTANT FIX: WARM UP AUDIO ***
                // Browsers block audio if you don't interact first.
                // We load the audio when you click this button to unlock the permission.
                if(audioRef.current) {
                    try {
                        audioRef.current.load(); 
                    } catch (e) {
                        console.log("Audio load warning:", e);
                    }
                }

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioContextRef.current = new AudioContext();
                    analyserRef.current = audioContextRef.current.createAnalyser();
                    microphoneRef.current = audioContextRef.current.createMediaStreamSource(stream);
                    microphoneRef.current.connect(analyserRef.current);
                    analyserRef.current.fftSize = 256;
                    
                    setListening(true);
                    detectBlow();
                } catch (err) {
                    console.log('Microphone access denied', err);
                    setListening(false);
                    alert("Could not access microphone. Please click the cake/candles to blow them out!");
                }
            };

            const stopListening = () => {
                if (microphoneRef.current) {
                    microphoneRef.current.disconnect();
                }
                if (audioContextRef.current) {
                    audioContextRef.current.close();
                }
                if (animationRef.current) {
                    cancelAnimationFrame(animationRef.current);
                }
                setListening(false);
            };

            const detectBlow = () => {
                if (!analyserRef.current) return;
                
                const bufferLength = analyserRef.current.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                
                const checkVolume = () => {
                    if (blown) return; 

                    analyserRef.current.getByteFrequencyData(dataArray);
                    
                    let sum = 0;
                    for(let i = 0; i < bufferLength; i++) {
                        sum += dataArray[i];
                    }
                    const average = sum / bufferLength;
                    
                    if (average > 40) {
                        handleBlow();
                    } else {
                        animationRef.current = requestAnimationFrame(checkVolume);
                    }
                };
                
                checkVolume();
            };

            const handleBlow = () => {
                if (blown) return; 
                setBlown(true);
                stopListening();

                // --- PLAY THE MUSIC HERE ---
                if (audioRef.current) {
                    const playPromise = audioRef.current.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log("Audio Error:", error);
                            // This alert will tell you exactly what is wrong
                            if(error.name === "NotAllowedError") {
                                alert("Browser blocked audio! You need to interact with the page more.");
                            } else if (error.name === "NotSupportedError" || error.message.includes("404")) {
                                alert("Cannot find 'senorita.mp3'. Make sure the file is in the same folder and named correctly!");
                            } else {
                                alert("Music error: " + error.message);
                            }
                        });
                    }
                }
                
                setTimeout(() => {
                    setBalloonsPopped(true);
                    createSparkles();
                    createConfetti();
                }, 500); 
                
                setTimeout(() => setShowWish(true), 1500); 
            };

            const createSparkles = () => {
                const newSparkles = Array.from({ length: 80 }, (_, i) => ({
                    id: i,
                    x: Math.random() * 100,
                    y: Math.random() * 100,
                    delay: Math.random() * 0.5,
                    duration: 1 + Math.random() * 2,
                    size: 20 + Math.random() * 30
                }));
                setSparkles(newSparkles);
            };

            const createConfetti = () => {
                const newConfetti = Array.from({ length: 100 }, (_, i) => ({
                    id: i,
                    x: Math.random() * 100,
                    startY: -10,
                    endY: 100 + Math.random() * 20,
                    delay: Math.random() * 0.3,
                    duration: 2 + Math.random() * 2,
                    rotation: Math.random() * 360,
                    color: ['#FF1493', '#FFD700', '#00CED1', '#FF69B4', '#FFA500', '#9D50BB', '#FF6B9D'][i % 7]
                }));
                setConfetti(newConfetti);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 overflow-hidden relative font-sans">
                    <div className="absolute inset-0 opacity-50 pointer-events-none">
                        <div className="absolute inset-0 bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 animate-pulse" />
                    </div>

                    <div className="absolute inset-0 opacity-40 pointer-events-none">
                        {Array.from({ length: 40 }).map((_, i) => (
                            <div
                                key={i}
                                className="absolute w-3 h-3 rounded-full"
                                style={{
                                    left: `${Math.random() * 100}%`,
                                    top: `${Math.random() * 100}%`,
                                    backgroundColor: ['#FFD700', '#FF69B4', '#00CED1', '#FF1493', '#FFA500'][i % 5],
                                    animation: `float ${3 + Math.random() * 3}s infinite ease-in-out`,
                                    animationDelay: `${Math.random() * 2}s`,
                                    boxShadow: '0 0 20px currentColor'
                                }}
                            />
                        ))}
                    </div>

                    <div className="absolute top-0 left-0 right-0 flex justify-center z-10 pointer-events-none">
                        <svg width="100%" height="100" className="opacity-90">
                            {Array.from({ length: 20 }).map((_, i) => (
                                <g key={i}>
                                    <polygon
                                        points={`${i * 60 + 10},10 ${i * 60 + 35},60 ${i * 60 + 60},10`}
                                        fill={['#FF1493', '#FFD700', '#00CED1', '#FF69B4', '#FFA500', '#9D50BB'][i % 6]}
                                        stroke="white"
                                        strokeWidth="3"
                                        style={{
                                            filter: 'drop-shadow(0 4px 6px rgba(0,0,0,0.3))',
                                            animation: `swing ${1 + (i % 3) * 0.5}s infinite ease-in-out`,
                                            transformOrigin: `${i * 60 + 35}px 10px`
                                        }}
                                    />
                                </g>
                            ))}
                        </svg>
                    </div>

                    {[
                        { top: '80px', left: '5%', bg: 'bg-pink-500', delay: '0s' },
                        { top: '120px', left: '15%', bg: 'bg-yellow-400', delay: '0.3s' },
                        { top: '100px', left: '85%', bg: 'bg-cyan-400', delay: '0.5s' },
                        { top: '140px', left: '90%', bg: 'bg-green-400', delay: '0.2s' },
                        { top: '90px', left: '10%', bg: 'bg-purple-500', delay: '0.4s' },
                        { top: '110px', left: '88%', bg: 'bg-orange-400', delay: '0.6s' }
                    ].map((balloon, idx) => (
                        <div
                            key={idx}
                            className="absolute transition-all duration-500 pointer-events-none"
                            style={{ top: balloon.top, left: balloon.left }}
                        >
                            <div className={`${balloonsPopped ? 'scale-0 opacity-0' : 'scale-100'} transition-all duration-500`}>
                                <div className="relative">
                                    <div 
                                        className={`w-24 h-32 ${balloon.bg} rounded-full shadow-2xl`}
                                        style={{
                                            animation: `bounce ${2 + idx * 0.2}s infinite ease-in-out`,
                                            animationDelay: balloon.delay,
                                            filter: 'drop-shadow(0 10px 20px rgba(0,0,0,0.4))'
                                        }}
                                    />
                                    <div className="absolute bottom-0 left-1/2 w-1 h-20 bg-white transform -translate-x-1/2" />
                                </div>
                            </div>
                        </div>
                    ))}

                    <div className="flex items-center justify-center min-h-screen relative z-20">
                        <div className="relative">
                            <div className="absolute -left-36 top-16 pointer-events-none">
                                <div 
                                    className="w-28 h-28 bg-gradient-to-br from-red-500 via-pink-500 to-orange-500 rounded-xl transform rotate-6 shadow-2xl"
                                    style={{ filter: 'drop-shadow(0 0 30px rgba(255,69,180,0.6))' }}
                                >
                                    <div className="absolute inset-0 border-4 border-yellow-300" style={{ margin: '10%' }} />
                                    <div className="absolute top-0 left-1/2 w-3 h-full bg-yellow-300 transform -translate-x-1/2" />
                                    <div className="absolute left-0 top-1/2 w-full h-3 bg-yellow-300 transform -translate-y-1/2" />
                                    <div className="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                        <div className="w-10 h-6 border-4 border-yellow-300 border-b-0 rounded-t-full" />
                                    </div>
                                </div>
                            </div>

                            <div className="absolute -right-36 top-16 pointer-events-none">
                                <div 
                                    className="w-28 h-28 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-xl transform -rotate-6 shadow-2xl"
                                    style={{ filter: 'drop-shadow(0 0 30px rgba(139,92,246,0.6))' }}
                                >
                                    <div className="absolute inset-0 border-4 border-pink-300" style={{ margin: '10%' }} />
                                    <div className="absolute top-0 left-1/2 w-3 h-full bg-pink-300 transform -translate-x-1/2" />
                                    <div className="absolute left-0 top-1/2 w-full h-3 bg-pink-300 transform -translate-y-1/2" />
                                    <div className="absolute -top-3 left-1/2 transform -translate-x-1/2">
                                        <div className="w-10 h-6 border-4 border-pink-300 border-b-0 rounded-t-full" />
                                    </div>
                                </div>
                            </div>

                            <div 
                                className="relative bg-white rounded-full p-6 shadow-2xl cursor-pointer"
                                style={{ filter: 'drop-shadow(0 0 50px rgba(255,255,255,0.5))' }}
                                onClick={candlesLit && !blown ? handleBlow : undefined}
                            >
                                <div className="flex flex-col-reverse items-center">
                                    <div className={`transition-all duration-500 ${cakeLayer >= 1 ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-20'}`}>
                                        <div 
                                            className="w-72 h-20 bg-gradient-to-r from-red-500 via-yellow-500 to-pink-500 rounded-xl shadow-2xl relative overflow-hidden"
                                            style={{ filter: 'drop-shadow(0 0 20px rgba(255,0,127,0.6))' }}
                                        >
                                            <div className="absolute inset-0 bg-gradient-to-b from-transparent to-black opacity-10" />
                                            <div className="absolute bottom-0 w-full h-3 bg-gradient-to-r from-purple-600 to-pink-600" />
                                        </div>
                                    </div>

                                    <div className={`transition-all duration-500 ${cakeLayer >= 2 ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-20'}`}>
                                        <div 
                                            className="w-64 h-16 bg-gradient-to-r from-cyan-400 via-blue-400 to-purple-400 rounded-xl shadow-2xl mb-1"
                                            style={{ filter: 'drop-shadow(0 0 20px rgba(0,206,209,0.6))' }}
                                        />
                                    </div>

                                    <div className={`transition-all duration-500 ${cakeLayer >= 3 ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-20'}`}>
                                        <div 
                                            className="w-56 h-14 bg-gradient-to-r from-orange-500 via-red-500 to-pink-500 rounded-xl shadow-2xl mb-1"
                                            style={{ filter: 'drop-shadow(0 0 20px rgba(255,165,0,0.6))' }}
                                        />
                                    </div>

                                    <div className={`transition-all duration-500 ${cakeLayer >= 4 ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-20'}`}>
                                        <div 
                                            className="w-48 h-12 bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 rounded-xl shadow-2xl mb-1"
                                            style={{ filter: 'drop-shadow(0 0 20px rgba(34,197,94,0.6))' }}
                                        />
                                    </div>

                                    <div className={`transition-all duration-500 ${cakeLayer >= 5 ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-20'}`}>
                                        <div 
                                            className="w-40 h-12 bg-gradient-to-r from-pink-400 via-purple-400 to-blue-400 rounded-xl shadow-2xl mb-1 relative"
                                            style={{ filter: 'drop-shadow(0 0 20px rgba(236,72,153,0.6))' }}
                                        >
                                            <div className="absolute -bottom-2 left-0 right-0 flex justify-around">
                                                {Array.from({ length: 7 }).map((_, i) => (
                                                    <div 
                                                        key={i} 
                                                        className="w-5 h-5 rounded-full"
                                                        style={{
                                                            backgroundColor: ['#FF1493', '#FFD700', '#00CED1', '#FF69B4', '#FFA500', '#9D50BB', '#FF6B9D'][i % 7],
                                                            boxShadow: `0 0 15px ${['#FF1493', '#FFD700', '#00CED1', '#FF69B4', '#FFA500', '#9D50BB', '#FF6B9D'][i % 7]}`
                                                        }}
                                                    />
                                                ))}
                                            </div>
                                            <div className="absolute -top-3 left-1/4 w-4 h-4 bg-red-500 rounded-full shadow-lg" />
                                            <div className="absolute -top-3 right-1/4 w-4 h-4 bg-red-500 rounded-full shadow-lg" />
                                            <div className="absolute -top-2 left-1/2 w-4 h-4 bg-red-500 rounded-full shadow-lg transform -translate-x-1/2" />
                                        </div>
                                    </div>

                                    <div className={`flex gap-4 mb-3 transition-all duration-500 ${candlesLit ? 'opacity-100' : 'opacity-0'}`}>
                                        {[0, 1, 2, 3, 4].map((i) => (
                                            <div key={i} className="relative">
                                                <div 
                                                    className={`w-3 h-16 rounded-t-full shadow-xl`}
                                                    style={{
                                                        background: ['linear-gradient(to bottom, #FF1493, #C71585)', 'linear-gradient(to bottom, #FFD700, #FFA500)', 'linear-gradient(to bottom, #00CED1, #008B8B)', 'linear-gradient(to bottom, #90EE90, #32CD32)', 'linear-gradient(to bottom, #DA70D6, #BA55D3)'][i],
                                                        boxShadow: `0 0 20px ${['#FF1493', '#FFD700', '#00CED1', '#90EE90', '#DA70D6'][i]}`
                                                    }}
                                                />
                                                
                                                {!blown ? (
                                                    <div className="absolute -top-8 left-1/2 transform -translate-x-1/2">
                                                        <div className="relative">
                                                            <div 
                                                                className="w-4 h-8 bg-gradient-to-t from-yellow-500 via-orange-500 to-red-500 rounded-full animate-pulse"
                                                                style={{
                                                                    animation: 'flicker 0.3s infinite alternate',
                                                                    filter: 'drop-shadow(0 0 15px #FFA500)'
                                                                }}
                                                            />
                                                            <div className="absolute top-1 left-1/2 w-3 h-6 bg-yellow-200 rounded-full transform -translate-x-1/2 animate-pulse" />
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="absolute -top-16 left-1/2 transform -translate-x-1/2">
                                                        <div 
                                                            className="w-6 h-12 bg-gray-400 opacity-60 rounded-full blur-md"
                                                            style={{ animation: 'smoke-rise 1.5s ease-out' }}
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {candlesLit && !blown && (
                                <div className="absolute -bottom-24 left-1/2 transform -translate-x-1/2 text-center w-full min-w-[300px]">
                                    <div 
                                        className="text-white text-xl font-bold bg-gradient-to-r from-pink-600 via-purple-600 to-blue-600 px-8 py-4 rounded-full shadow-2xl animate-bounce cursor-pointer"
                                        style={{
                                            boxShadow: '0 0 40px rgba(236,72,153,0.8)',
                                            animation: 'bounce 1s infinite'
                                        }}
                                        onClick={startListening}
                                    >
                                        {listening ? 'üé§ Blow into your microphone!' : 'üé§ Click to enable mic'}
                                    </div>
                                    <div className="text-white text-sm mt-2 opacity-80">(Or click the cake!)</div>
                                </div>
                            )}
                        </div>
                    </div>

                    {sparkles.map((sparkle) => (
                        <div
                            key={sparkle.id}
                            className="absolute animate-ping"
                            style={{
                                left: `${sparkle.x}%`,
                                top: `${sparkle.y}%`,
                                animationDelay: `${sparkle.delay}s`,
                                animationDuration: `${sparkle.duration}s`,
                                fontSize: `${sparkle.size}px`,
                                filter: 'drop-shadow(0 0 10px currentColor)'
                            }}
                        >
                            ‚ú®
                        </div>
                    ))}

                    {confetti.map((conf) => (
                        <div
                            key={conf.id}
                            className="absolute w-3 h-3 rounded-sm"
                            style={{
                                left: `${conf.x}%`,
                                top: `${conf.startY}%`,
                                backgroundColor: conf.color,
                                animation: `fall ${conf.duration}s linear forwards`,
                                animationDelay: `${conf.delay}s`,
                                transform: `rotate(${conf.rotation}deg)`,
                                boxShadow: `0 0 10px ${conf.color}`
                            }}
                        />
                    ))}

                    {showWish && (
                        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
                            <div 
                                className="bg-gradient-to-br from-pink-200 via-purple-200 to-cyan-200 rounded-3xl p-12 max-w-xl shadow-2xl transform mx-4"
                                style={{
                                    animation: 'scale-in 0.5s ease-out',
                                    boxShadow: '0 0 60px rgba(236,72,153,0.8)'
                                }}
                            >
                                <div className="text-center">
                                    <div className="text-6xl mb-6 animate-wiggle">üéÇüéâüéà</div>
                                    <h2 
                                        className="text-6xl font-bold mb-6"
                                        style={{
                                            background: 'linear-gradient(135deg, #FF1493, #9D50BB, #00CED1)',
                                            WebkitBackgroundClip: 'text',
                                            WebkitTextFillColor: 'transparent',
                                            textShadow: '0 0 30px rgba(255,20,147,0.5)'
                                        }}
                                    >
                                        Happy Birthday BIPANNAAA! 
                                    </h2>
                                    <p className="text-gray-900 blur-[2px] hover:blur-none transition duration-500 cursor-pointer">
                                        You add so much value to the world, simply by being in it..! üåü <br />
                                        God, I pray that you keep the person reading this alive,safe, healthy and happy for many more years to come..! ü§ó <br />
                                    </p>
                                    <div className="text-6xl mb-6 animate-pulse">üéÅ‚ú®üíù</div>
                                    <p className="text-purple-700 font-bold text-2xl blur-sm hover:blur-none transition duration-500 cursor-pointer">
                                        Wishing you all the happiness in the world!
                                    </p>
                                    <button 
                                        onClick={() => window.location.reload()}
                                        className="mt-6 bg-purple-600 text-white px-6 py-2 rounded-full hover:bg-purple-700 transition-colors"
                                    >
                                        Replay
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <style>{`
                        @keyframes float {
                            0%, 100% { transform: translateY(0) rotate(0deg); }
                            50% { transform: translateY(-30px) rotate(180deg); }
                        }
                        @keyframes bounce {
                            0%, 100% { transform: translateY(0); }
                            50% { transform: translateY(-20px); }
                        }
                        @keyframes swing {
                            0%, 100% { transform: rotate(-5deg); }
                            50% { transform: rotate(5deg); }
                        }
                        @keyframes flicker {
                            0% { transform: translateX(-50%) scale(1); }
                            100% { transform: translateX(-50%) scale(1.15); }
                        }
                        @keyframes smoke-rise {
                            0% { opacity: 0.8; transform: translateX(-50%) translateY(0); }
                            100% { opacity: 0; transform: translateX(-50%) translateY(-50px); }
                        }
                        @keyframes fall {
                            to { 
                                transform: translateY(100vh) rotate(720deg);
                                opacity: 0;
                            }
                        }
                        @keyframes scale-in {
                            from { transform: scale(0.5); opacity: 0; }
                            to { transform: scale(1); opacity: 1; }
                        }
                    `}</style>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BirthdayGreeting />);
    </script>
</body>
</html>
